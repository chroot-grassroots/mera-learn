/*
 * Auto-generated Complete Registry for TypeScript Bundling
 * Generated on: 2026-01-15T21:30:27.756617
 * 
 * This file contains ALL 12 mappings and parsed YAML data.
 * Gets bundled into mera-app.js via TypeScript compilation.
 * 
 * This file is automatically generated by dev/py/registry_builder.py
 * Do not edit manually - your changes will be overwritten
 */

import { 
    NewUserWelcomeProgressManager, NewUserWelcomeComponentConfigSchema, NewUserWelcomeComponentProgressSchema, createInitialProgress as createInitialNewUserWelcomeProgress
} from '../components/cores/newUserWelcomeCore.js';
import { 
    BasicTaskProgressManager, BasicTaskComponentConfigSchema, BasicTaskComponentProgressSchema, validateBasicTaskStructure, createInitialProgress as createInitialBasicTaskProgress
} from '../components/cores/basicTaskCore.js';

/**
 * Component registration data structure
 */
interface ComponentRegistration {
    componentClass: any;
    configSchema: any;
    progressSchema: any;
    typeName: string;
}

/**
 * Lesson metrics data structure
 */
interface LessonMetrics {
    pageCount: number;
    componentCount: number;
    title: string;
    difficulty: string;
}

/**
 * MAPPING 1: Component Registrations
 * Array of all registered component types with their associated schemas
 */
export const componentRegistrations: ComponentRegistration[] = [
    {
        componentClass: NewUserWelcomeProgressManager,
        configSchema: NewUserWelcomeComponentConfigSchema,
        progressSchema: NewUserWelcomeComponentProgressSchema,
        typeName: 'new_user_welcome'
    },
    {
        componentClass: BasicTaskProgressManager,
        configSchema: BasicTaskComponentConfigSchema,
        progressSchema: BasicTaskComponentProgressSchema,
        typeName: 'basic_task'
    }
];

/**
 * MAPPING 2: Component Type to Class Map
 * Maps component type string to constructor class
 */
export const componentTypeMap = new Map<string, any>([
    ["new_user_welcome", NewUserWelcomeProgressManager],
    ["basic_task", BasicTaskProgressManager]
]);

/**
 * MAPPING 3: Component Config Schema Map
 * Maps component type string to config schema
 */
export const configSchemaMap = new Map<string, any>([
    ["new_user_welcome", NewUserWelcomeComponentConfigSchema],
    ["basic_task", BasicTaskComponentConfigSchema]
]);

/**
 * MAPPING 4: Component Progress Schema Map
 * Maps component type string to progress schema
 */
export const progressSchemaMap = new Map<string, any>([
    ["new_user_welcome", NewUserWelcomeComponentProgressSchema],
    ["basic_task", BasicTaskComponentProgressSchema]
]);

/**
 * MAPPING 4.5: Component Validator Function Map
 * Maps component type string to validation function
 * Used by progressIntegrity for recovery operations
 */
export const componentValidatorMap = new Map<string, (progress: any, config: any) => { cleaned: any; defaultedRatio: number }>([
    ["basic_task", validateBasicTaskStructure]
]);

/**
 * MAPPING 4.7: Component Initializer Function Map
 * Maps component type string to initializer function
 * Used to create initial progress for new users
 */
export const componentInitializerMap = new Map<string, (config: any) => any>([
    ["new_user_welcome", createInitialNewUserWelcomeProgress],
    ["basic_task", createInitialBasicTaskProgress]
]);

/**
 * MAPPING 5: All Entity IDs (Lessons + Menus)
 * Set of all entity IDs across the platform
 */
export const allLessonIds = [1, 12345];

/**
 * MAPPING 6: All Component IDs
 * Set of all component IDs used across all entities
 */
export const allComponentIds = [123456, 123457, 1000001];

/**
 * MAPPING 7: Entity Metrics Map
 * Maps entity ID to metrics (page count, component count, etc.)
 */
export const lessonMetrics = new Map<number, LessonMetrics>([
    [12345, { pageCount: 2, componentCount: 2, title: "Phishing Recognition Basics", difficulty: "beginner" }],
    [1, { pageCount: 1, componentCount: 1, title: "Welcome to Mera", difficulty: "beginner" }]
]);

/**
 * MAPPING 8: Component ID to Type Map
 * Maps component ID (number) to component type string
 * Critical for progress migration - allows validation against correct schema
 */
export const componentIdToTypeMap = new Map<number, string>([
    [123456, "basic_task"],
    [123457, "basic_task"],
    [1000001, "new_user_welcome"]
]);

/**
 * MAPPING 8.5: Component ID to Lesson ID Map
 * Maps component ID (number) to the lesson ID that contains it
 * Used by progressIntegrity to find lesson configs for component validation
 */
export const componentToLessonMap = new Map<number, number>([
    [123456, 12345],
    [123457, 12345],
    [1000001, 1]
]);

/**
 * MAPPING 9: Domain-Lesson Map
 * Maps domain ID to array of lesson IDs in that domain
 */
export const domainLessonMap = new Map<number, number[]>([
    [1001, [12345]]
]);

/**
 * MAPPING 10: Curriculum Data
 * Complete parsed curriculum structure
 */
const curriculumDataRaw = null;

/**
 * Curriculum Registry - provides methods for querying curriculum data
 */
export class CurriculumRegistry {
    constructor(
        private curriculum: any,
        private lessonIds: Set<number>,
        private domainMap: Map<number, number[]>,
        private componentIdToType: Map<number, string>,
        private componentToLesson: Map<number, number>
    ) {}
    
    hasEntity(entityId: number): boolean {
        return this.lessonIds.has(entityId);
    }

    hasLesson(lessonId: number): boolean {
        const metadata = lessonMetadata.find(l => l.id === lessonId);
        return metadata?.entityType === "lesson" || false;
    }

    hasMenu(menuId: number): boolean {
        const metadata = lessonMetadata.find(l => l.id === menuId);
        return metadata?.entityType === "menu" || false;
    }

    hasDomain(domainId: number): boolean {
        return this.domainMap.has(domainId);
    }

    getEntityPageCount(entityId: number): number {
        const metrics = lessonMetrics.get(entityId);
        if (!metrics) {
            throw new Error(
                `Entity ${entityId} not found in registry. Cannot determine page count.`
            );
        }
        return metrics.pageCount;
    }

    hasComponent(componentId: number): boolean {
        return this.componentIdToType.has(componentId);
    }

    getComponentType(componentId: number): string | undefined {
        return this.componentIdToType.get(componentId);
    }

    getAllComponentIds(): number[] {
        return Array.from(this.componentIdToType.keys());
    }

    getAllLessonIds(): number[] {
        return Array.from(this.lessonIds);
    }

    getAllDomainIds(): number[] {
        return Array.from(this.domainMap.keys());
    }

    getLessonsInDomain(domainId: number): number[] | undefined {
        return this.domainMap.get(domainId);
    }

    getLessonIdForComponent(componentId: number): number | undefined {
        return this.componentToLesson.get(componentId);
    }
}

export const curriculumData = new CurriculumRegistry(
    curriculumDataRaw,
    new Set(allLessonIds),
    domainLessonMap,
    componentIdToTypeMap,
    componentToLessonMap
);

/**
 * MAPPING 11: Domain Data
 * Array of all domain definitions
 */
export const domainData = [];

/**
 * MAPPING 12: Entity Metadata
 * Complete metadata for all entities (lessons and menus)
 */
export const lessonMetadata = [
  {
    "id": 12345,
    "path": "static/yaml/lessons/phishing-basics.yaml",
    "title": "Phishing Recognition Basics",
    "entityType": "lesson",
    "pageCount": 2,
    "componentCount": 2,
    "difficulty": "beginner",
    "estimatedMinutes": 8,
    "required": true,
    "domainId": 1001
  },
  {
    "id": 1,
    "path": "static/yaml/lessons/welcome_menu.yaml",
    "title": "Welcome to Mera",
    "entityType": "lesson",
    "pageCount": 1,
    "componentCount": 1,
    "difficulty": "beginner",
    "estimatedMinutes": 5,
    "required": true,
    "domainId": null
  }
];

console.log(`Mera Registry loaded with all 12 mappings:`);
console.log(`  - ${componentRegistrations.length} component types`);
console.log(`  - ${allLessonIds.length} entities (lessons + menus)`);
console.log(`  - ${allComponentIds.length} component IDs`);
console.log(`  - ${componentIdToTypeMap.size} component ID->type mappings`);
console.log(`  - ${domainLessonMap.size} domains`);
